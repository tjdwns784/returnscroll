<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="chat">

	<!-- 채팅방 리스트 만들기 -->
	<select id="selectAllRoom" resultType="map"> 
		SELECT roomId AS ID, roomName AS NAME
		FROM chatroom
	</select>

	<!-- 채팅방 리스트랑 현재 접속자 수 불러오도록 -->
	<select id="selectRoom" resultType="map">
		SELECT cr.roomId AS ID, cr.roomName AS NAME, COUNT(*) AS people
		FROM chatroom cr, chatuser cu 
		WHERE cr.roomId = cu.chatRoomId
		GROUP BY cr.roomId;
	</select>
	
	<select id="roomIn" parameterType="_int" resultType="map">
		SELECT *
		FROM chatroom
		WHERE roomId = #{value}
	</select>
	
	<insert id="createRoom" parameterType="map">
		INSERT INTO chatroom
		(roomId, roomName, roomKing, roomDate)
		VALUES
		(NULL, #{roomName}, #{createUser},NOW())
	</insert>
	
	<insert id="addUser" parameterType="map">
		INSERT INTO chatuser
		(chatUserId, chatRoomId,joinDate)
		VALUES
		(#{uid}, #{roomId},NOW())
	</insert>
	
	<select id="roomMember" parameterType="_int" resultType="map">
		SELECT ch.chatUserId AS uid, ch.chatRoomId AS roomId, u.nick AS nick
		FROM chatuser ch, users u
		WHERE ch.chatRoomId = #{value} AND ch.chatUserId = u.uid;
	</select>
	
</mapper>